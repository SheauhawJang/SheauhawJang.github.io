<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mahjong Theory & Score Calculator</title>
        <link rel="stylesheet" href="mahjong.css" />
    </head>
    <body>
        <div class="language-bar">
            <a href="mahjong.html">简体中文</a>
            <a href="mahjong-tw.html">正體中文</a>
            <a href="mahjong-ja.html">日本語</a>
            <a>English</a>
        </div>
        <h1>Mahjong Theory & Score Calculator</h1>
        <ul class="input-note-wrapper" style="padding-left: 1.5em; margin-left: 0;">
            <li>Supports Mahjong Theory calculation for Normal Type Mahjong, Chinese Official Mahjong (MCR), Japanese Riichi Mahjong (RCR), 16-tile Mahjong, Hong Kong Style Taiwanese Mahjong, and any-tile-count Mahjong.</li>
            <li>Supports Joker (wild tile, universal tile, laizi, magic tile, etc.).</li>
            <li>Supports point or score calculation for Chinese Official Mahjong (MCR) and Japanese Riichi Mahjong (RCR).</li>
        </ul>
        <div class="section">
            <div class="title-button-container">
                <label for="inputText">Please enter your hand</label>
                <button class="toggle-button" id="inputButton" onclick="toggleInput()" style="color: #f58c8a">Open Input Panel ▼</button>
            </div>
            <div class="input-area" id="textInput">
                <input type="text" id="inputText" placeholder="For example：1112345678999mE" />
                <div class="input-note-wrapper">
                    <button class="toggle-button" id="inputNoteButton" onclick="toggleNote()" style="color: #4caf50">Show input instructions ▼</button>
                    <div class="input-note" id="inputNote" style="display: none">
                        The input field supports the following formats, which can be mixed:
                        <ol style="margin-top: 0">
                            <li>Tenhou Format: Suits are represented by number + color (lowercase), where: <b>Characters=m</b>, <b>Bamboo=s</b>, <b>Circles=p</b>. Honors, <b>East / South / West / North / White Dragon / Green Dragon / Red Dragon</b>, are represented by <b>1z2z3z4z5z6z7z</b> in order. Adjacent tiles with the same color suffix can only keep the suffix of the rightmost tile.</li>
                            <li>
                                Chinese Official Mahjong Helper Format: Suits are the same as "Tenhou Format". Honors,
                                <b>East / South / West / North / White Dragon / Green Dragon / Red Dragon</b>, are represented by <b>ESWNPFC</b> in order.
                            </li>
                            <li>English Mahjong Printing Format: Suits are the same as "Tenhou Format". Winds, <b>East / South / West / North</b>, are represented by <b>ESWN</b> in order. Dragons, <b>White=Wh</b>, <b>Green=G</b>, <b>Red=R</b>.</li>
                            <li>Hanyu Pinyin Format: Same as Tenhou Format. Except <b>Characters=w</b>,<b>Circles=b</b>.</li>
                            <li>Notation Format: Character tiles are represented by Chinese numbers <b>一二三四五六七八九</b>. Circle tiles are represented by circled numbers <b>①②③④⑤⑥⑦⑧⑨</b>. Bamboo tiles are represented by full-width numbers <b>１２３４５６７８９</b>. Honor tiles are represented by corresponding Chinese characters.</li>
                            <li>Unicode Format: Use Unicode U+1F000 to U+1F02B characters to represent the corresponding cards.</li>
                        </ol>
                        <p>About Bonus: <b>Spring / Summer / Autumn / Winter / Plum / Orchid / Chrysanthemum / Bamboo</b> are represented by <b>1h2h3h4h5h6h7h8h</b> or <b>1f2f3f4f5f6f7f8f</b> in order. Some mahjong rules consider bonus as joker. This calculator does not have this function. Please convert them into joker if necessary.<br /></p>
                        About Joker:
                        <ul style="margin-top: 0">
                            <li>
                                Non-directional Joker
                                <img src="./cards/a1j.gif" style="vertical-align: middle" />: Can be considered as any suit or honor tile. Represented by <b>1j/J</b>.
                            </li>
                            <li>Characters Joker <img src="./cards/a2j.gif" style="vertical-align: middle" />: Can be considered as any character tile. Represented by <b>2j/im/iw</b>.</li>
                            <li>Circles Joker <img src="./cards/a3j.gif" style="vertical-align: middle" />: Can be considered as any circle tile. Represented by <b>3j/ip/ib</b>.</li>
                            <li>Bamboo Joker <img src="./cards/a4j.gif" style="vertical-align: middle" />: Can be considered as any bamboo tile. Represented by <b>4j/is</b>.</li>
                            <li>Suits Joker <img src="./cards/a5j.gif" style="vertical-align: middle" />: Can be considered as any suit tile. Represented by <b>5j</b>.</li>
                            <li>Winds Joker <img src="./cards/a6j.gif" style="vertical-align: middle" />: Can be considered as any wind tile. Represented by <b>6j</b>.</li>
                            <li>Dragons Joker <img src="./cards/a7j.gif" style="vertical-align: middle" />: Can be considered as any dragon tile. Represented by <b>7j</b>.</li>
                            <li>Honors Joker <img src="./cards/a8j.gif" style="vertical-align: middle" />: Can be considered as any honor tile. Represented by <b>8j/iz</b>.</li>
                            <li>Bonus Joker <img src="./cards/a9j.gif" style="vertical-align: middle" />: Can be considered as any bonus tile. Represented by <b>9j/H/X/9h/9f/ih/if</b>.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="input-area" id="boardInput" style="display: none">
                <div class="card-container" id="input-pic"></div>
                <div class="input-keyboard">
                    <div class="input-mainkey">
                        <div class="input-row">
                            <div></div>
                            <img src="./cards/1m.gif" class="input-card-button" onclick="addInput(0)" />
                            <img src="./cards/2m.gif" class="input-card-button" onclick="addInput(1)" />
                            <img src="./cards/3m.gif" class="input-card-button" onclick="addInput(2)" />
                            <img src="./cards/4m.gif" class="input-card-button" onclick="addInput(3)" />
                            <img src="./cards/5m.gif" class="input-card-button" onclick="addInput(4)" />
                            <img src="./cards/6m.gif" class="input-card-button" onclick="addInput(5)" />
                            <img src="./cards/7m.gif" class="input-card-button" onclick="addInput(6)" />
                            <img src="./cards/8m.gif" class="input-card-button" onclick="addInput(7)" />
                            <img src="./cards/9m.gif" class="input-card-button" onclick="addInput(8)" />
                            <img src="./cards/0m.gif" class="input-card-button" onclick="addInput({ id: 4, sp: 1 })" />
                            <div></div>
                        </div>
                        <div class="input-row">
                            <div></div>
                            <img src="./cards/1p.gif" class="input-card-button" onclick="addInput(9)" />
                            <img src="./cards/2p.gif" class="input-card-button" onclick="addInput(10)" />
                            <img src="./cards/3p.gif" class="input-card-button" onclick="addInput(11)" />
                            <img src="./cards/4p.gif" class="input-card-button" onclick="addInput(12)" />
                            <img src="./cards/5p.gif" class="input-card-button" onclick="addInput(13)" />
                            <img src="./cards/6p.gif" class="input-card-button" onclick="addInput(14)" />
                            <img src="./cards/7p.gif" class="input-card-button" onclick="addInput(15)" />
                            <img src="./cards/8p.gif" class="input-card-button" onclick="addInput(16)" />
                            <img src="./cards/9p.gif" class="input-card-button" onclick="addInput(17)" />
                            <img src="./cards/0p.gif" class="input-card-button" onclick="addInput({ id: 13, sp: 1 })" />
                            <div></div>
                        </div>
                        <div class="input-row">
                            <div></div>
                            <img src="./cards/1s.gif" class="input-card-button" onclick="addInput(18)" />
                            <img src="./cards/2s.gif" class="input-card-button" onclick="addInput(19)" />
                            <img src="./cards/3s.gif" class="input-card-button" onclick="addInput(20)" />
                            <img src="./cards/4s.gif" class="input-card-button" onclick="addInput(21)" />
                            <img src="./cards/5s.gif" class="input-card-button" onclick="addInput(22)" />
                            <img src="./cards/6s.gif" class="input-card-button" onclick="addInput(23)" />
                            <img src="./cards/7s.gif" class="input-card-button" onclick="addInput(24)" />
                            <img src="./cards/8s.gif" class="input-card-button" onclick="addInput(25)" />
                            <img src="./cards/9s.gif" class="input-card-button" onclick="addInput(26)" />
                            <img src="./cards/0s.gif" class="input-card-button" onclick="addInput({ id: 22, sp: 1 })" />
                            <div></div>
                        </div>
                        <div class="input-row">
                            <div></div>
                            <img src="./cards/1z.gif" class="input-card-button" onclick="addInput(27)" />
                            <img src="./cards/2z.gif" class="input-card-button" onclick="addInput(28)" />
                            <img src="./cards/3z.gif" class="input-card-button" onclick="addInput(29)" />
                            <img src="./cards/4z.gif" class="input-card-button" onclick="addInput(30)" />
                            <img src="./cards/5z.gif" class="input-card-button" onclick="addInput(31)" />
                            <img src="./cards/6z.gif" class="input-card-button" onclick="addInput(32)" />
                            <img src="./cards/7z.gif" class="input-card-button" onclick="addInput(33)" />
                            <img src="./cards/0z.gif" class="input-card-button" onclick="addInput({ id: 31, sp: 1 })" />
                            <div></div>
                        </div>
                        <div class="input-row">
                            <div></div>
                            <img src="./cards/1h.gif" class="input-card-button" onclick="addInput(34)" />
                            <img src="./cards/2h.gif" class="input-card-button" onclick="addInput(35)" />
                            <img src="./cards/3h.gif" class="input-card-button" onclick="addInput(36)" />
                            <img src="./cards/4h.gif" class="input-card-button" onclick="addInput(37)" />
                            <img src="./cards/5h.gif" class="input-card-button" onclick="addInput(38)" />
                            <img src="./cards/6h.gif" class="input-card-button" onclick="addInput(39)" />
                            <img src="./cards/7h.gif" class="input-card-button" onclick="addInput(40)" />
                            <img src="./cards/8h.gif" class="input-card-button" onclick="addInput(41)" />
                            <div></div>
                        </div>
                        <div class="input-row">
                            <div></div>
                            <img src="./cards/1j.gif" class="input-card-button" onclick="addInput(42)" />
                            <img src="./cards/2j.gif" class="input-card-button" onclick="addInput(43)" />
                            <img src="./cards/3j.gif" class="input-card-button" onclick="addInput(44)" />
                            <img src="./cards/4j.gif" class="input-card-button" onclick="addInput(45)" />
                            <img src="./cards/5j.gif" class="input-card-button" onclick="addInput(46)" />
                            <img src="./cards/6j.gif" class="input-card-button" onclick="addInput(47)" />
                            <img src="./cards/7j.gif" class="input-card-button" onclick="addInput(48)" />
                            <img src="./cards/8j.gif" class="input-card-button" onclick="addInput(49)" />
                            <img src="./cards/9j.gif" class="input-card-button" onclick="addInput(50)" />
                            <div></div>
                        </div>
                        <div class="card-container" id="input-pic-bonus"></div>
                        <div class="win-grid">
                            <span>Dora Indicator</span>
                            <div class="card-container" id="input-pic-dorap"></div>
                            <span>Ura Dora Indicator</span>
                            <div class="card-container" id="input-pic-urap"></div>
                        </div>
                    </div>
                    <div class="input-subkeys">
                        <button onclick="clearInput()" class="subkey-button">Clear</button>
                        <button onclick="sortInput()" class="subkey-button">Sort</button>
                        <button onclick="removeInput(ipids[0].length - 1, -1)" class="subkey-button enable-no-empty">Delete</button>
                        <button onclick="subtileInput(0)" class="subkey-button" id="subkey_chi">Chow</button>
                        <button onclick="subtileInput(1)" class="subkey-button enabled-no-flower">Pung</button>
                        <button onclick="subtileInput(2, 1)" class="subkey-button enabled-no-flower">Expose Kong</button>
                        <button onclick="subtileInput(2, 5)" class="subkey-button enabled-no-flower">Extend Kong</button>
                        <button onclick="subtileInput(2, 0)" class="subkey-button enabled-no-flower">Conceal Kong</button>
                        <button onclick="subtileInput(3)" class="subkey-button enable-no-empty">+Bonus</button>
                        <button onclick="subtileInput(4)" class="subkey-button enable-no-empty">Dora Indicate</button>
                        <button onclick="subtileInput(5)" class="subkey-button enable-no-empty">Ura Dora Indicate</button>
                    </div>
                </div>
            </div>
            <div style="text-align: center">
                <button onclick="processInput()" class="random-button">Calculate</button>
                <button onclick="randomInput()" class="random-button">Get <input type="number" id="randomCardCount" value="14" min="1" max="99" /> random tiles</button>
            </div>
            <div class="output-box-head">
                <div class="output-context" style="text-align: center" id="output-cnt"></div>
                <div class="card-container" id="output-pic"></div>
                <div class="card-container" id="output-pic-bonus" style="text-align: right"></div>
            </div>
            <div class="output-box">
                <div class="title-button-container">
                    <div class="output-title">Normal Type Theory</div>
                    <button class="toggle-button" id="toggle-output-std" onclick="toggleOutput(0)">Fold ▲</button>
                </div>
                <div class="output-context" id="output-std"></div>
                <div class="output-context" id="brief-output-std" style="display: none"></div>
                <div class="output-time" id="time-output-std"></div>
            </div>
            <div class="output-box">
                <div class="title-button-container">
                    <div class="output-title">Chinese Official Mahjong (MCR) Standard Type Theory</div>
                    <button class="toggle-button" id="toggle-output-gb" onclick="toggleOutput(1)">Fold ▲</button>
                </div>
                <div class="output-context" id="output-gb"></div>
                <div class="output-context" id="brief-output-gb" style="display: none"></div>
                <div class="output-time" id="time-output-gb"></div>
            </div>
            <div class="output-box">
                <div class="title-button-container">
                    <div class="output-title">Japanese Riichi Mahjong (RCR) Standard Type Theory</div>
                    <button class="toggle-button" id="toggle-output-jp" onclick="toggleOutput(2)">Fold ▲</button>
                </div>
                <div class="output-context" id="output-jp"></div>
                <div class="output-context" id="brief-output-jp" style="display: none"></div>
                <div class="output-time" id="time-output-jp"></div>
            </div>
            <div class="output-box">
                <div class="title-button-container">
                    <div class="output-title">Hong Kong Style Taiwanese Mahjong Theory</div>
                    <button class="toggle-button" id="toggle-output-tw" onclick="toggleOutput(3)">Fold ▲</button>
                </div>
                <div class="output-context" id="output-tw"></div>
                <div class="output-context" id="brief-output-tw" style="display: none"></div>
                <div class="output-time" id="time-output-tw"></div>
            </div>
            <div class="output-box" id="score-gb" style="display: none">
                <div class="title-button-container">
                    <div class="output-title">Chinese Official Mahjong (MCR) Points Calculator</div>
                    <button class="toggle-button" id="toggle-output-score-gb" onclick="toggleOutput(4)">Fold ▲</button>
                </div>
                <div id="options-output-score-gb">
                    <div class="output-options">
                        <span>Prevalent</span>
                        <div class="output-option-group">
                            <label><input type="radio" name="score-gb-global-wind" value="27" checked />East</label>
                            <label><input type="radio" name="score-gb-global-wind" value="28" />South</label>
                            <label><input type="radio" name="score-gb-global-wind" value="29" />West</label>
                            <label><input type="radio" name="score-gb-global-wind" value="30" />North</label>
                        </div>
                        <span>Seat</span>
                        <div class="output-option-group">
                            <label><input type="radio" name="score-gb-local-wind" value="27" checked />East</label>
                            <label><input type="radio" name="score-gb-local-wind" value="28" />South</label>
                            <label><input type="radio" name="score-gb-local-wind" value="29" />West</label>
                            <label><input type="radio" name="score-gb-local-wind" value="30" />North</label>
                        </div>
                        <span>Winning Way</span>
                        <div class="output-option-group">
                            <label><input type="radio" name="score-gb-wintype" value="0" checked />Claim</label>
                            <label><input type="radio" name="score-gb-wintype" value="80" />Draw</label>
                        </div>
                        <span>Winning Status</span>
                        <div class="output-option-group">
                            <label><input type="checkbox" name="score-gb-wininfo" value="44" />Last Tile</label>
                            <label><input type="checkbox" name="score-gb-wininfo" value="46" />Out with Replacement</label>
                            <label><input type="checkbox" name="score-gb-wininfo" value="47" />Robbing the Kong</label>
                            <label><input type="checkbox" name="score-gb-wininfo" value="58" />Last of its Kind</label>
                        </div>
                        <button onclick="processGBScore()" class="score-button">Calculate</button>
                    </div>
                </div>
                <div class="output-context" id="output-score-gb"></div>
                <div class="output-context" id="brief-output-score-gb" style="display: none"></div>
                <div class="output-time" id="time-output-score-gb">Ready to start!</div>
            </div>
            <div class="output-box" id="score-jp">
                <div class="title-button-container">
                    <div class="output-title">Japanese Riichi Mahjong (RCR) Scores Calculator</div>
                    <button class="toggle-button" id="toggle-output-score-jp" onclick="toggleOutput(5)">Fold ▲</button>
                </div>
                <div id="options-output-score-jp">
                    <div class="output-options">
                        <span>Prevailing</span>
                        <div class="output-option-group">
                            <label><input type="radio" name="score-jp-global-wind" value="27" checked>East</label>
                            <label><input type="radio" name="score-jp-global-wind" value="28">South</label>
                            <label><input type="radio" name="score-jp-global-wind" value="29">West</label>
                            <label><input type="radio" name="score-jp-global-wind" value="30">North</label>
                        </div>
                        <span>Seat</span>
                        <div class="output-option-group">
                            <label><input type="radio" name="score-jp-local-wind" value="27" checked>East</label>
                            <label><input type="radio" name="score-jp-local-wind" value="28">South</label>
                            <label><input type="radio" name="score-jp-local-wind" value="29">West</label>
                            <label><input type="radio" name="score-jp-local-wind" value="30">North</label>
                        </div>
                        <span>Winning Way</span>
                        <div class="output-option-group">
                            <label><input type="radio" name="score-jp-wintype" value="0" checked>Claim</label>
                            <label><input type="radio" name="score-jp-wintype" value="1">Draw</label>
                        </div>
                        <span>Riichi Status</span>
                        <div class="output-option-group">
                            <label><input type="checkbox" name="score-jp-wininfo" value="1">Riichi</label>
                            <label><input type="checkbox" name="score-jp-wininfo" value="16">Double Riichi</label>
                            <label><input type="checkbox" name="score-jp-wininfo" value="3">Ippatsu</label>
                        </div>
                        <span>Winning Status</span>
                        <div class="output-option-group">
                            <label><input type="checkbox" name="score-jp-wininfo" value="32">First Turn</label>
                            <label><input type="checkbox" name="score-jp-wininfo" value="13">Last Tile</label>
                            <label><input type="checkbox" name="score-jp-wininfo" value="12">After a Kong</label>
                            <label><input type="checkbox" name="score-jp-wininfo" value="15">Robbing the Kong</label>
                        </div>
                        <button onclick="processJPScore()" class="score-button">Calculate</button>
                    </div>
                    <div class="output-options">
                        <span>Dora Indicator</span>
                        <div class="card-container" id="output-pic-doras" style="text-align: left"></div>
                        <span>Ura Dora Indicator</span>
                        <div class="card-container" id="output-pic-uras" style="text-align: left"></div>
                    </div>
                </div>
                <div class="output-context" id="output-score-jp"></div>
                <div class="output-context" id="brief-output-score-jp" style="display: none"></div>
                <div class="output-time" id="time-output-score-jp">Ready to start!</div>
            </div>
        </div>
        <div class="section title-button-container">
            <div class="output-time">v4.4.3</div>
        </div>
        <script src="mahjong.js"></script>
        <script src="mahjong-document.js"></script>
        <script>
            function tilesInfo(tcnt) {
                const meld = Math.floor(tcnt / 3);
                let output = `${tcnt} tiles\n`;
                switch (tcnt % 3) {
                    case 1:
                        output += `3n+1 Type: Winning needs ${meld} melds and ${1} pairs`;
                        break;
                    case 2:
                        output += `3n+2 Type: Winning needs ${meld} melds and ${1} pairs`;
                        break;
                    case 0:
                        output += `3n Type: Winning needs ${meld} melds and ${0} pairs`;
                        break;
                }
                return output;
            }
            function toggleInput() {
                const board = document.getElementById("boardInput");
                const button = document.getElementById("inputButton");
                const text = document.getElementById("textInput");
                const isVisible = board.style.display !== "none";
                board.style.display = isVisible ? "none" : "block";
                text.style.display = isVisible ? "block" : "none";
                button.textContent = isVisible ? "Open Input Panel ▼" : "Close Input Panel ▲";
                if (!isVisible) drawInputCards();
                if (!isVisible) adjustButtonsFontSize();
            }
            function toggleNote() {
                const note = document.getElementById("inputNote");
                const button = document.getElementById("inputNoteButton");
                const isVisible = note.style.display !== "none";
                note.style.display = isVisible ? "none" : "block";
                button.textContent = isVisible ? "Show input instructions ▼" : "Hide input instructions ▲";
            }
            function toggleOutput(i) {
                const ids = ["output-std", "output-gb", "output-jp", "output-tw", "output-score-gb", "output-score-jp"];
                const d = document.getElementById(ids[i]);
                const b = document.getElementById("toggle-" + ids[i]);
                const s = document.getElementById("brief-" + ids[i]);
                const o = document.getElementById("options-" + ids[i]);
                const v = d.style.display !== "none";
                d.style.display = v ? "none" : "block";
                s.style.display = v ? "block" : "none";
                if (o) o.style.display = v ? "none" : "block";
                b.textContent = v ? "Expand ▼" : "Fold ▲";
                addWorkerCardHelper();
            }
            window.onload = function () {
                randomInput();
            };
            const lang = "en";
        </script>
    </body>
</html>
